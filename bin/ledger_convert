#!/bin/bash

# Create temp file
temp=$(mktemp)

# Format file depending on account
if [ $2 = "assets:bank:student" ] || [ $2 = "assets:bank:isa" ] || [ $2 = "assets:bank:res" ]
then
	echo "natwest"
	# Prepare file
	## Remove blank lines | Replace column headers | remove single quotes > send to temp
	sed '/^[[:space:]]*$/d' $1 | sed '1s/.*/date,,payee,amount,,,/' | sed -e "s/'//g" > $temp
	date="%d/%m/%Y"

elif [ $2 = "assets:bank:monzo" ]
then
	echo "monzo"
	# Prepare file
	## Replace column header | change general tag to misc | Remove time from date > send to temp
	sed '1s/.*/transid,date,amount,,,,payee,,,,,/' $1 | sed 's/general/misc/g' | sed 's/T[0-9][0-9]:[0-9][0-9]:[0-9][0-9]Z//g' > $temp
	date="%Y-%m-%d"
else
	# Write account names
	echo "Choose a real account."
	echo "Account options:"
	echo "	assets:bank:student"
	echo "	assets:bank:isa"
	echo "	assets:bank:res"
	echo "	assets:bank:monzo"
fi

# Run ledger command
ledger convert $temp --input-date-format ${date} --account $2 --rich-data --auto-match -f ~/.ledger.journal

# Remove temp file
rm ${temp}
